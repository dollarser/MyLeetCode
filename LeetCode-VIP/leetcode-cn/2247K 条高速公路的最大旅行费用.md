# 2247K æ¡é«˜é€Ÿå…¬è·¯çš„æœ€å¤§æ—…è¡Œè´¹ç”¨
<p>ä¸€ç³»åˆ—é«˜é€Ÿå…¬è·¯è¿æ¥ä» <code>0</code> åˆ° <code>n - 1</code> çš„ <code>n</code> ä¸ªåŸå¸‚ã€‚ç»™å®šä¸€ä¸ªäºŒç»´æ•´æ•°æ•°ç»„ <code>highways</code>ï¼Œå…¶ä¸­ <code>highways[i] = [city1<sub>i</sub>, city2<sub>i</sub>, toll<sub>i</sub>]</code> è¡¨ç¤ºæœ‰ä¸€æ¡é«˜é€Ÿå…¬è·¯è¿æ¥ <code>city1<sub>i</sub></code> å’Œ<code>city2<sub>i</sub></code>ï¼Œå…è®¸ä¸€è¾†æ±½è½¦ä» <code>city1<sub>i</sub></code> å‰å¾€ <code>city2<sub>i</sub></code>ï¼Œ<strong>åä¹‹äº¦ç„¶</strong>ï¼Œè´¹ç”¨ä¸º <code>toll<sub>i</sub></code>ã€‚</p>

<p>ç»™ä½ ä¸€ä¸ªæ•´æ•° <code>k</code>ï¼Œä½ è¦<strong>æ­£å¥½</strong>ç»è¿‡ <code>k</code> æ¡å…¬è·¯ã€‚ä½ å¯ä»¥ä»ä»»ä½•ä¸€ä¸ªåŸå¸‚å‡ºå‘ï¼Œä½†åœ¨æ—…é€”ä¸­æ¯ä¸ªåŸå¸‚<strong>æœ€å¤š</strong>åªèƒ½è®¿é—®ä¸€æ¬¡ã€‚</p>

<p>è¿”å›<em>æ‚¨æ—…è¡Œçš„æœ€å¤§è´¹ç”¨ã€‚å¦‚æœæ²¡æœ‰ç¬¦åˆè¦æ±‚çš„è¡Œç¨‹ï¼Œåˆ™è¿”å› <code>-1</code>ã€‚</em></p>

<p><strong class="example">ç¤ºä¾‹ 1:</strong></p>
<img src="https://assets.leetcode.com/uploads/2022/04/18/image-20220418173304-1.png" style="height: 200px; width: 327px;" />
<pre>
<strong>è¾“å…¥:</strong> n = 5, highways = [[0,1,4],[2,1,3],[1,4,11],[3,2,3],[3,4,2]], k = 3
<strong>è¾“å‡º:</strong> 17
<strong>è§£é‡Š:</strong>
ä¸€ä¸ªå¯èƒ½çš„è·¯å¾„æ˜¯ä» 0 -&gt; 1 -&gt; 4 -&gt; 3ã€‚è¿™æ¬¡æ—…è¡Œçš„è´¹ç”¨æ˜¯ 4 + 11 + 2 = 17ã€‚
å¦ä¸€ç§å¯èƒ½çš„è·¯å¾„æ˜¯ä» 4 -&gt; 1 -&gt; 2 -&gt; 3ã€‚è¿™æ¬¡æ—…è¡Œçš„è´¹ç”¨æ˜¯ 11 + 3 + 3 = 17ã€‚
å¯ä»¥è¯æ˜ï¼Œ17 æ˜¯ä»»ä½•æœ‰æ•ˆè¡Œç¨‹çš„æœ€å¤§å¯èƒ½è´¹ç”¨ã€‚
æ³¨æ„ï¼Œæ—…è¡Œ 4 -&gt; 1 -&gt; 0 -&gt; 1 æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºä½ è®¿é—®äº†åŸå¸‚ 1 ä¸¤æ¬¡ã€‚
</pre>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ 2:</strong></p>
<img src="https://assets.leetcode.com/uploads/2022/04/18/image-20220418173342-2.png" style="height: 200px; width: 217px;" />
<pre>
<strong>è¾“å…¥:</strong> n = 4, highways = [[0,1,3],[2,3,2]], k = 2
<strong>è¾“å‡º:</strong> -1
<strong>è§£é‡Š:</strong> æ²¡æœ‰é•¿åº¦ä¸º 2 çš„æœ‰æ•ˆè¡Œç¨‹ï¼Œå› æ­¤è¿”å›-1ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤º:</strong></p>

<ul>
	<li><code>2 &lt;= n &lt;= 15</code></li>
	<li><code>1 &lt;= highways.length &lt;= 50</code></li>
	<li><code>highways[i].length == 3</code></li>
	<li><code>0 &lt;= city1<sub>i</sub>, city2<sub>i</sub> &lt;= n - 1</code></li>
	<li><code>city1<sub>i</sub> != city2<sub>i</sub></code></li>
	<li><code>0 &lt;= toll<sub>i</sub> &lt;= 100</code></li>
	<li><code>1 &lt;= k &lt;= 50</code></li>
	<li>
	<p data-group="1-1">æ²¡æœ‰é‡å¤çš„é«˜é€Ÿå…¬è·¯ã€‚</p>
	</li>
</ul>
































# è§£é¢˜:
# 1.ã€daydayUpppğŸˆã€‘çŠ¶å‹DP
### è§£é¢˜æ€è·¯

**å˜é‡å®šä¹‰ï¼š**

$dis[i][j] = v$ ï¼š$dis(city_i,city_j) = v$
$cnt[S] = x$ ï¼šçŠ¶æ€ $S$ ä¸­çš„åŸå¸‚æ•°ï¼ˆå³äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°ï¼‰
$dp[S][u] = v$ ï¼šçŠ¶æ€ $S$ ä¸­ä»¥ $u$ ä¸ºç»ˆç‚¹çš„æœ€å¤§å¼€é”€ã€‚$-1$ è¡¨ç¤ºéæ³•çŠ¶æ€

**çŠ¶æ€è½¬ç§»**

$$dp[S][v] = max\{dp[S'][u] + dis[u][v]\}$$

**æ¡ä»¶é™åˆ¶**

$$S'+u = S \And u,v \in S \And dp[S'][u] \ne -1$$

**æœ€ç»ˆç­”æ¡ˆ**

$$res = max\{dp[S][u]\},cnt[S] = k + 1 \And u \in S$$

**å…·ä½“çœ‹ä»£ç å®ç°å³å¯ï¼Œæœ‰ä»»ä½•ç–‘é—®æ¬¢è¿è¯„è®ºåŒºæŒ‡å‡º** ğŸ¬

### ä»£ç 

```cpp
class Solution {
public:
    int dis[20][20];
    int cnt[200007];
    int dp[400007][20];
    int maximumCost(int n, vector<vector<int>>& highways, int k) {
        if(k + 1 > n) return -1;// ä¸å¯èƒ½çš„æƒ…å†µ
        int mask = (1 << n);
        cnt[0] = 0;
        for(int i = 1;i < mask;i ++) {
            cnt[i] = cnt[i & (i - 1)] + 1;
            if(cnt[i] == 1) {
                for(int j = 0;j < n;j ++) {
                    if(i >> j & 1) {
                        dp[cnt[i]][j] = 0;
                        break;
                    }
                }
            } 
        } 
        for(int i = 0;i < n;i ++) {
            for(int j = 0;j < n;j ++) dis[i][j] = -1;
        }
        for(auto& i : highways) {
            dis[i[0]][i[1]] = i[2];
            dis[i[1]][i[0]] = i[2];
        }
        // k æ¡è·¯ -> k + 1 ä¸ªç‚¹
        int res = -1;
        for(int i = 1;i < mask;i ++) {
            if(cnt[i] > k + 1 || cnt[i] == 1) continue;
            for(int u = 0;u < n;u ++) {
                if(i >> u & 1) {
                    int S = i ^ (1 << u);
                    dp[i][u] = -1;
                    for(int v = 0;v < n;v ++) {
                        if(S >> v & 1) {
                            if(dis[u][v] != -1 && dp[S][v] != -1) {
                                if(dp[i][u] == -1) {
                                    dp[i][u] = dp[S][v] + dis[u][v];
                                } else {
                                    dp[i][u] = max(
                                        dp[S][v] + dis[u][v],
                                        dp[i][u]
                                    );
                                }
                            }
                        }
                    }
                    if(cnt[i] == k + 1) {
                        res = max(res,dp[i][u]);
                    }
                }
                
            }
        }
        return res;
    }
};
```
# 2.[Python] çŠ¶å‹ + è®°å¿†åŒ–é€’å½’ 
### è§£é¢˜æ€è·¯
çŠ¶å‹æ ‡è®°è®¿é—®è¿‡çš„ç‚¹

### ä»£ç 

```python3
class Solution:
    def maximumCost(self, n: int, highways: List[List[int]], k: int) -> int:
        graph = defaultdict(dict)
        for a, b, c in highways:
            graph[a][b] = c
            graph[b][a] = c

        @lru_cache(None)
        def dfs(cur, explored):
            if explored.bit_count() == k + 1:
                return 0

            ans = -inf
            for other, v in graph[cur].items():
                if not explored & (o := 1 << other):
                    ans = max(ans, dfs(other, explored | o) + v)
            return ans

        return max(-1, max(dfs(i, 1 << i) for i in range(n)))
```
# 3.2247. Maximum Cost of Trip With K Highways  bfs +çŠ¶å‹
åštspç³»åˆ—çš„ æ¥åˆ°è¿™é¢˜ 
ç±»ä¼¼943 å’Œ847é¢˜ã€‚

è¿™ç§é¢˜å‹ æ ¸å¿ƒæ˜¯ä¸€ä¸ªçŠ¶æ€ éœ€è¦åŠ ä¸€ä¸ª**æœ€åä¸€ä¸ªè®¿é—®çš„å…ƒç´ **ã€‚è¿™æ ·çš„äºŒç»´æ•°ç»„ æ¥æè¿°
è¿™æ ·çš„æ–¹å¼æ¥é˜²æ­¢é‡å¤è®¿é—®ã€‚
å› ä¸ºè¿™é¢˜ä¸å•å•visè¿‡å°±ä¸ç®¡äº†ã€‚
è¿˜è¦å–maxinnum æ‰€ä»¥ ä¸´æ—¶å¼€å‘äº†visçš„å¦å¤–ä¸€ä¸ªåŠŸèƒ½ å°±æ˜¯é¡ºä¾¿è®°å½•å½“å‰çŠ¶æ€çš„cost_sumå€¼ã€‚
å°±åƒæœ€çŸ­è·¯ç®—æ³•é‡Œçš„distæ•°ç»„çš„ä½œç”¨ã€‚
```cpp [1-è‰ç¨¿]
class Solution
{
public:
#define arr array<int, 3>
    unordered_map<int, vector<pair<int, int>>> mp;
    int vis[15][1 << 15];
    int maximumCost(int n, vector<vector<int>> &a, int k)
    {
        if(k>=n)return -1;//è¿™ä¸ªå‡æ ç›´æ¥ä»1188ms å˜æˆ32msã€‚ã€‚å°±ç¦»è°±ã€‚
        queue<arr> q;//ä¸èƒ½ç”¨ä¼˜å…ˆé˜Ÿåˆ—ã€‚ä»–ä¼šæ‰“ä¹±å±‚åºéå†çš„é¡ºåºã€‚
        for (auto &a : a)
        {
            int l = a[0], r = a[1], c = a[2];
            mp[l].push_back({r, c});
            mp[r].push_back({l, c});
        }
        for (int i = 0; i < n; ++i)
        {
            q.push({0, i, 1 << i});
            vis[i][1 << i] = 1;
        }
        int mx=-1;
        while (k--)
        {
            int size = q.size();
            while (size--)
            {
                auto [sum, x, y] = q.front();
                q.pop();
                for (auto &[v, c] : mp[x])
                {
                    int t = y | 1 << v;
                    if ((vis[v][t] == 0||vis[v][t]<sum+c)&&(y>>v&1)==0)
                    {
                        vis[v][t] = sum+c;
                        q.push({c + sum, v, t});
                        if(k==0)
                        mx=max(mx,sum+c);
                    }
                }
            }
        }
     
        return mx;
        // ä¸€ä¸ªç‚¹åªèƒ½è®¿é—®ä¸€æ¬¡ã€‚ã€‚ã€‚å“¦å“¦å“¦ã€‚ã€‚ã€‚æ‡‚äº†ã€‚ã€‚
        // è¿™æœ‰å¥½å‡ é“ç±»å‹é¢˜ã€‚ã€‚
        // ä¸€ä¸ªé›†åˆè¦åˆ¤æ–­ä»–æ˜¯å¦è¿é€šã€‚ã€‚
        // æ‰€æœ‰çš„ç‚¹å¼€å§‹ã€‚èµ°kå±‚ bfsã€‚ã€‚å¼€é”€è®°å½•ç€ã€‚
        // åˆ°ç¬¬kå±‚çš„æ—¶å€™ ç¬¬ä¸€ä¸ªå°±æ˜¯æœ€å¤§çš„ã€‚ã€‚ã€‚
        // æŠŠä¼˜å…ˆé˜Ÿåˆ—å’Œç¨‹åºéå†é›†åˆèµ·æ¥ã€‚ã€‚
    }
};
```
# 4.è®°å¿†åŒ–dfs
### è§£é¢˜æ€è·¯
- n<=15ï¼Œæš—ç¤ºçŠ¶å‹
- è®°å¿†åŒ–dfsæœç´¢çŠ¶æ€ç”± `(å½“å‰ä½ç½®ï¼Œçœ‹è¿‡çš„ç‚¹)` å”¯ä¸€ç¡®å®š

æ—¶é—´å¤æ‚åº¦ `O(n*2^n)`
### ä»£ç 

```python3
class Solution:
    def maximumCost(self, n: int, highways: List[List[int]], k: int) -> int:
        @lru_cache(None)
        def dfs(cur: int, visited: int) -> int:
            if visited.bit_count() == k + 1:
                return 0

            res = -int(1e20)
            for next, weight in adjMap[cur].items():
                if not (visited >> next) & 1:
                    res = max(res, dfs(next, visited | (1 << next)) + weight)
            return res

        adjMap = defaultdict(lambda: defaultdict(lambda: -int(1e20)))
        for u, v, w in highways:
            adjMap[u][v] = w
            adjMap[v][u] = w

        res = -1
        for i in range(n):
            res = max(res, dfs(i, 1 << i))
        dfs.cache_clear()
        return res


```
