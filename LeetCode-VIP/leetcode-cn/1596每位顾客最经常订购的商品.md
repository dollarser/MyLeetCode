# 1596æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“
<p>è¡¨ï¼š<code>Customers</code></p>

<pre>
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
+---------------+---------+
customer_id æ˜¯è¯¥è¡¨ä¸»é”®
è¯¥è¡¨åŒ…å«æ‰€æœ‰é¡¾å®¢çš„ä¿¡æ¯
</pre>

<p>&nbsp;</p>

<p>è¡¨ï¼š<code>Orders</code></p>

<pre>
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| order_date    | date    |
| customer_id   | int     |
| product_id    | int     |
+---------------+---------+
order_id æ˜¯è¯¥è¡¨ä¸»é”®
è¯¥è¡¨åŒ…å«é¡¾å®¢ customer_id çš„è®¢å•ä¿¡æ¯
æ²¡æœ‰é¡¾å®¢ä¼šåœ¨ä¸€å¤©å†…è®¢è´­ç›¸åŒçš„å•†å“<strong> å¤šäºä¸€æ¬¡</strong></pre>

<p>&nbsp;</p>

<p>è¡¨ï¼š<code>Products</code></p>

<pre>
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| product_id    | int     |
| product_name  | varchar |
| price         | int     |
+---------------+---------+
product_id æ˜¯è¯¥è¡¨ä¸»é”®
è¯¥è¡¨åŒ…å«äº†æ‰€æœ‰å•†å“çš„ä¿¡æ¯
</pre>

<p>&nbsp;</p>

<p>å†™ä¸€ä¸ª SQL è¯­å¥ï¼Œæ‰¾åˆ°æ¯ä¸€ä¸ªé¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ã€‚</p>

<p>ç»“æœè¡¨å•åº”è¯¥æœ‰æ¯ä¸€ä½è‡³å°‘ä¸‹è¿‡ä¸€æ¬¡å•çš„é¡¾å®¢ <code>customer_id</code>&nbsp;,&nbsp;ä»–æœ€ç»å¸¸è®¢è´­çš„å•†å“çš„&nbsp;<code>product_id</code>&nbsp;å’Œ&nbsp;<code>product_name</code>ã€‚</p>

<p>è¿”å›ç»“æœ<strong> æ²¡æœ‰é¡ºåºè¦æ±‚</strong>ã€‚</p>

<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<code><strong>è¾“å…¥ï¼š</strong>
Customersè¡¨ï¼š</code>
+-------------+-------+
| customer_id | name  |
+-------------+-------+
| 1           | Alice |
| 2           | Bob   |
| 3           | Tom   |
| 4           | Jerry |
| 5           | John  |
+-------------+-------+
<code>Ordersè¡¨ï¼š</code>
+----------+------------+-------------+------------+
| order_id | order_date | customer_id | product_id |
+----------+------------+-------------+------------+
| 1        | 2020-07-31 | 1           | 1          |
| 2        | 2020-07-30 | 2           | 2          |
| 3        | 2020-08-29 | 3           | 3          |
| 4        | 2020-07-29 | 4           | 1          |
| 5        | 2020-06-10 | 1           | 2          |
| 6        | 2020-08-01 | 2           | 1          |
| 7        | 2020-08-01 | 3           | 3          |
| 8        | 2020-08-03 | 1           | 2          |
| 9        | 2020-08-07 | 2           | 3          |
| 10       | 2020-07-15 | 1           | 2          |
+----------+------------+-------------+------------+
<code>Productsè¡¨ï¼š</code>
+------------+--------------+-------+
| product_id | product_name | price |
+------------+--------------+-------+
| 1          | keyboard     | 120   |
| 2          | mouse        | 80    |
| 3          | screen       | 600   |
| 4          | hard disk    | 450   |
+------------+--------------+-------+
<strong>è¾“å‡ºï¼š</strong>
+-------------+------------+--------------+
| customer_id | product_id | product_name |
+-------------+------------+--------------+
| 1           | 2          | mouse        |
| 2           | 1          | keyboard     |
| 2           | 2          | mouse        |
| 2           | 3          | screen       |
| 3           | 3          | screen       |
| 4           | 1          | keyboard     |
+-------------+------------+--------------+
<strong>è§£é‡Šï¼š</strong>
Alice (customer 1) ä¸‰æ¬¡è®¢è´­é¼ æ ‡, ä¸€æ¬¡è®¢è´­é”®ç›˜, æ‰€ä»¥é¼ æ ‡æ˜¯ Alice æœ€ç»å¸¸è®¢è´­çš„å•†å“.
Bob (customer 2) ä¸€æ¬¡è®¢è´­é”®ç›˜, ä¸€æ¬¡è®¢è´­é¼ æ ‡, ä¸€æ¬¡è®¢è´­æ˜¾ç¤ºå™¨, æ‰€ä»¥è¿™äº›éƒ½æ˜¯ Bob æœ€ç»å¸¸è®¢è´­çš„å•†å“.
Tom (customer 3) åªä¸¤æ¬¡è®¢è´­æ˜¾ç¤ºå™¨, æ‰€ä»¥æ˜¾ç¤ºå™¨æ˜¯ Tom æœ€ç»å¸¸è®¢è´­çš„å•†å“.
Jerry (customer 4) åªä¸€æ¬¡è®¢è´­é”®ç›˜, æ‰€ä»¥é”®ç›˜æ˜¯ Jerry æœ€ç»å¸¸è®¢è´­çš„å•†å“.
John (customer 5) æ²¡æœ‰è®¢è´­è¿‡å•†å“, æ‰€ä»¥æˆ‘ä»¬å¹¶æ²¡æœ‰æŠŠ John åŒ…å«åœ¨ç»“æœè¡¨ä¸­.</pre>
































# è§£é¢˜:
# 1.ä½¿ç”¨å­æŸ¥è¯¢å®ç°
1. è®¡ç®— customer_id å¯¹åº”çš„æœ€å¤§çš„äº§å“æ•°é‡
```
select customer_id, max(num) as max_num
from (
    select customer_id, count(product_id) num
    from Orders
    group by customer_id, product_id) a
group by customer_id
```

å› ä¸ºæœ€å¤§æ•°é‡ç›¸åŒçš„äº§å“éƒ½è¦è¾“å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦è®¡ç®—ä¸‹æ¯ä¸ªäº§å“çš„æ•°é‡ï¼Œç„¶åç­‰äº 1. ä¸­è®¡ç®—çš„æœ€å¤§äº§å“æ•°é‡å³å¯ã€‚

2. è®¡ç®— customer_id å’Œå¯¹åº”çš„äº§å“idã€äº§å“æ•°é‡ã€äº§å“åç§°
```
select o.customer_id, o.product_id, count(o.product_id) num, p.product_name
from Orders o left join Products p on o.product_id = p.product_id
group by o.customer_id, o.product_id
```

3. å°†1ã€2è·å–çš„æ•°æ®è¿›è¡Œè¡¨è¿æ¥ï¼ŒæŸ¥å‡ºäº§å“æ•°é‡=æœ€å¤§äº§å“æ•°é‡çš„äº§å“å³å¯
```
select a1.customer_id, a2.product_id, a2.product_name
from (
    select customer_id, max(num) as max_num
    from (
        select customer_id, count(product_id) num
        from Orders
        group by customer_id, product_id) a
    group by customer_id
) a1 left join (
    select o.customer_id, o.product_id, count(o.product_id) num, p.product_name
    from Orders o left join Products p on o.product_id = p.product_id
    group by o.customer_id, o.product_id
) a2 on a1.customer_id = a2.customer_id and a1.max_num = a2.num
```

# 2.ã€track & traningã€‘æ€è·¯ç®€å•ï¼Œæ€§èƒ½é«˜æ•ˆ
### æ–¹ä¾¿å¿«é€Ÿå­¦ä¹ ç®—æ³•ä¸ç†è§£~
ğŸŒ‡ ç‚¹èµ ğŸ‘ æ”¶è— â­ç•™è¨€ ğŸ“ ä¸€é”®ä¸‰è¿ ~å…³æ³¨Jamï¼Œä»ä½ æˆ‘åšèµ·ï¼

**å…„å¼Ÿä¼šèƒŒå›ä½ ï¼Œå¥³äººä¼šç¦»å¼€ä½ ï¼Œé‡‘é’±ä¼šè¯±æƒ‘ä½ ï¼Œç”Ÿæ´»ä¼šåˆéš¾ä½ ï¼Œåªæœ‰æ•°å­¦ä¸ä¼šï¼Œä¸ä¼šå°±æ˜¯ä¸ä¼š**
**å¤©æ‰ä¸å¦ï¼Œå–å†³äºæœ€ç»ˆè¾¾åˆ°çš„é«˜åº¦ã€‚çœŸæ­£çš„å¤©æ‰æ˜¯é‚£äº›è„šè¸å®åœ°çš„äºº**
**é™ä¸‹å¿ƒæ¥å¥½å¥½åšè‡ªå·±ï¼Œèµ°ç¨³è„šä¸‹æ¯ä¸€æ­¥ï¼Œå°±æ˜¯æœ€å¥½çš„è·¯ï¼Œå¼ºè€…éƒ½æ˜¯å­¤ç‹¬çš„**

æ¨è python ç®—æ³•çš„ä¹¦ç±ï¼Œä½“ç³»åŒ–å­¦ä¹ ç®—æ³•ä¸æ•°æ®ç»“æ„ï¼Œç”¨æ­£ç¡®çš„æ–¹å¼æˆä¸ºofferæ”¶å‰²æœº
[leetcode](https://github.com/ls1248659692/leetcode) â€”â€”  **ç³»ç»ŸåŒ–å¿«é€Ÿå­¦ä¹ ç®—æ³•ï¼Œè¿™ä¸æ˜¯å†…å·ï¼Œè¿™åªæ˜¯æ‚„æ‚„åœ°åŠªåŠ›ï¼Œç„¶åæƒŠè‰³æ‰€æœ‰çš„äºº**
![image.png](https://pic.leetcode-cn.com/1649572867-sVgxTI-image.png)

---
### æ±‚è§£æ€è·¯
çª—å£å‡½æ•°

### ä»£ç 

```mysql
# Write your MySQL query statement below
SELECT 
    o.customer_id,
    o.product_id,
    p.product_name
FROM 
    products p,(
    SELECT 
        customer_id,
        product_id,
        rank() over(partition by customer_id order by count(1) desc) rk 
    FROM 
        orders
    GROUP BY 
        customer_id,product_id
) o
WHERE 
    o.rk = 1 and p.product_id = o.product_id;
```
# 3.æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“

### ä»£ç 

```mysql

SELECT a.customer_id customer_id,
        a.product_id product_id,
        p. product_name  product_name   
FROM (SELECT customer_id,
                product_id,
                RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS ranking 
        FROM Orders
        GROUP BY customer_id,product_id) a
LEFT JOIN Products p USING(product_id)
WHERE a.ranking=1


```
# 4.ä½¿ç”¨çª—å£å‡½æ•°ï¼Œæ„Ÿè§‰æœ‰å¾ˆå¤§ä¼˜åŒ–ç©ºé—´ï¼Œæ±‚æŒ‡æ•™
```
select 
        customer_id,
        product_id,
        product_name
from
(
        select
                customer_id,
                product_id,
                product_name,
                rk
        from
        (
                select
                        customer_id,
                        t1.product_id,
                        product_name,
                        sal_num,
                        rank() over(partition by customer_id order by sal_num desc) rk
                from
                (
                        select 
                                customer_id,
                                product_id,
                                count(*) sal_num
                        from orders
                        group by customer_id,product_id
                        
                ) t1
                left join products p on t1.product_id = p.product_id
        )t2
        where rk = 1
) t3
```
