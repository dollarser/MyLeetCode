# 571ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°
<p><code>Numbers</code> è¡¨ï¼š</p>

<pre>
+-------------+------+
| Column Name | Type |
+-------------+------+
| num         | int  |
| frequency   | int  |
+-------------+------+
num æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºæŸä¸ªæ•°å­—åœ¨è¯¥æ•°æ®åº“ä¸­çš„å‡ºç°é¢‘ç‡ã€‚</pre>

<p>&nbsp;</p>
<a href="https://baike.baidu.com/item/%E4%B8%AD%E4%BD%8D%E6%95%B0/3087401" target="_blank"><strong>ä¸­ä½æ•°</strong></a> æ˜¯å°†æ•°æ®æ ·æœ¬ä¸­åŠæ•°è¾ƒé«˜å€¼å’ŒåŠæ•°è¾ƒä½å€¼åˆ†éš”å¼€çš„å€¼ã€‚

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè§£å‹ <code>Numbers</code> è¡¨ï¼ŒæŠ¥å‘Šæ•°æ®åº“ä¸­æ‰€æœ‰æ•°å­—çš„ <strong>ä¸­ä½æ•°</strong> ã€‚ç»“æœå››èˆäº”å…¥è‡³ <strong>ä¸€ä½å°æ•°</strong> ã€‚</p>

<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>

<p>&nbsp;</p>

<div class="top-view__1vxA">
<div class="original__bRMd">
<div>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong> 
Numbers è¡¨ï¼š
+-----+-----------+
| num | frequency |
+-----+-----------+
| 0   | 7         |
| 1   | 1         |
| 2   | 3         |
| 3   | 1         |
+-----+-----------+
<strong>è¾“å‡ºï¼š</strong>
+--------+
| median |
+--------+
| 0.0    |
+--------+
<strong>è§£é‡Šï¼š</strong>
å¦‚æœè§£å‹è¿™ä¸ª Numbers è¡¨ï¼Œå¯ä»¥å¾—åˆ° [0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3] ï¼Œæ‰€ä»¥ä¸­ä½æ•°æ˜¯ (0 + 0) / 2 = 0 ã€‚
</pre>
</div>
</div>
</div>
































# è§£é¢˜:
# 1.ã€é²¸æã€‘571. ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°ï¼ˆè€ƒç‚¹ï¼šæ­£ååºã€é¿å…è®¨è®ºå¥‡å¶æ€§ï¼‰
##### æ€è·¯

æœ¬é¢˜ä¾æ—§é‡‡å–æ­£ååºçš„æ–¹å¼ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯ç»™å®šæ•°å­—çš„é¢‘ç‡æ¥æŸ¥è¯¢ä¸­ä½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿˜åŸåŸæœ¬çš„åºåˆ—ï¼Œæ‰€ä»¥è¦å¯¹`frequency`è¿›è¡Œç´¯åŠ ï¼ˆæ­£åºï¼‰ï¼Œç„¶åå–ååºï¼Œåœ¨å’Œ`sum(frequency)`æ¯”è¾ƒã€‚

##### ç®—æ³•

1. æ­£ååº

```sql
select
    a.*,
    sum(frequency) over(order by num) as rnk1,
    sum(frequency) over(order by num desc) as rnk2,
    sum(frequency) over() as s
from Numbers a

# è¾“å‡º
{"headers": ["num", "frequency", "rnk1", "rnk2", "s"], 
"values": [[0, 7, 7, 12, 12], 
           [1, 1, 8, 5, 12], 
           [2, 3, 11, 4, 12], 
           [3, 1, 12, 1, 12]]}
```

2.  `where rnk1>=s/2 and rnk2>=s/2`

##### ç­”æ¡ˆ

```sql
select 
    round(avg(num),1) as median 
from
(select
    a.*,
    sum(frequency) over(order by num) as rnk1,
    sum(frequency) over(order by num desc) as rnk2,
    sum(frequency) over() as s
from Numbers a) tmp
where rnk1>=s/2 
and rnk2>=s/2
```

ğŸ¥°è§‰å¾—è¿˜ä¸é”™çš„è¯ï¼Œç‚¹ä¸ªèµï¼ŒåŠ ä¸ªå…³æ³¨å§~ğŸ¥°
# 2.sum over (order by )
### è§£é¢˜æ€è·¯
ä½¿ç”¨**sum over(order by )** å¯¹æ•°å­—ä¸ªæ•°è¿›è¡Œ**æ­£åºå’Œé€†åºç´¯è®¡**ï¼Œ
å½“æŸä¸€æ•°å­—çš„ **æ­£åºå’Œé€†åºç´¯è®¡** å‡å¤§äº **æ•´ä¸ªåºåˆ—çš„æ•°å­—ä¸ªæ•°çš„ä¸€åŠ** æ—¶å³ä¸ºä¸­ä½æ•°ï¼Œ
å°†æœ€åé€‰å®šçš„ä¸€ä¸ªæˆ–ä¸¤ä¸ªä¸­ä½æ•°è¿›è¡Œæ±‚å‡å€¼å³å¯ã€‚
![image.png](https://pic.leetcode-cn.com/1606296718-IJZeTW-image.png)




### ä»£ç 

```mysql
# Write your MySQL query statement below
select avg(number) median
from
    (select number,
        sum(frequency) over(order by number) asc_accumu,
        sum(frequency) over(order by number desc) desc_accumu
        from numbers) t1, 
    (select sum(frequency) total from numbers) t2
where asc_accumu >= total/2 and desc_accumu >=total/2
```
# 3.è¯¦è§£ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°ï¼ˆä¸‰ç§æ–¹æ³•ï¼‰
## SQLï¼šæ–¹æ³•ä¸€

```sql
select avg(num) as median from (
	select
		num,
		sum(frequency) over(order by num desc) desc_frequency,
		sum(frequency) over(order by num asc) asc_frequency,
		sum(frequency) over() total_frequency
	from numbers
) as temp
where desc_frequency >= total_frequency / 2
and asc_frequency >= total_frequency / 2;
```

## è§£æ

ä¸­ä½æ•°å°±æ˜¯å°†æ‰€æœ‰æ•°å­—æŒ‰ç…§å‡åºæˆ–è€…é™åºæ’åˆ—ï¼Œç„¶åå–æœ€ä¸­é—´çš„æ•°å­—

- æ•°å­—ä¸ªæ•°æ˜¯å¥‡æ•°çš„è¯ï¼Œé‚£ä¹ˆä¸­ä½æ•°ä¼šåœ¨è¿™ä¸ªåºåˆ—ä¸­
- æ•°å­—ä¸ªæ•°æ˜¯å¶æ•°çš„è¯ï¼Œé‚£ä¹ˆä¸­ä½æ•°æ˜¯æœ€ä¸­é—´çš„ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼

æ­¥éª¤ï¼š

- `sum(frequency) over() total_frequency` è®¡ç®—å‡ºæ‰€æœ‰æ•°å­—çš„ä¸ªæ•°ï¼Œè¿™é‡Œä½¿ç”¨çª—å£å‡½æ•° `over()` å°±ä¸éœ€è¦å†åé¢ä½¿ç”¨ `group by`
  - è®¡ç®—æ€»æ•°è¿˜å¯ä»¥ç”¨ `select sum(frequency) as total_frequency from numbers`
- `sum(frequency) over(order by num desc) desc_frequency` ä½¿ç”¨çª—å£å‡½æ•° `over(order by num desc)` æŒ‰ç…§ `num` é™åºè®¡ç®—å‡ºå½“å‰æ•°å­—å’Œä¹‹å‰æ•°å­—å‡ºç°çš„æ¬¡æ•°
  ```sql
  select num, sum(frequency) over(order by num desc) desc_frequency
  from numbers;
  ```
  | num | desc_frequency |
  | --- | -------------- |
  | 3   | 1              |
  | 2   | 4              |
  | 1   | 5              |
  | 0   | 12             |
- `sum(frequency) over(order by num asc) asc_frequency` ä½¿ç”¨çª—å£å‡½æ•° `over(order by num asc)` æŒ‰ç…§ `num` å‡åºè®¡ç®—å‡ºå½“å‰æ•°å­—å’Œä¹‹å‰æ•°å­—å‡ºç°çš„æ¬¡æ•°
  ```sql
  select num, sum(frequency) over(order by num asc) asc_frequency
  from numbers;
  ```
  | num | asc_frequency |
  | --- | ------------- |
  | 0   | 7             |
  | 1   | 8             |
  | 2   | 11            |
  | 3   | 12            |
- å°†æŸ¥è¯¢å‡ºæ¥çš„ `num` ï¼Œ `desc_frequency` ï¼Œ `asc_frequency` ï¼Œ `total_frequency` ä½œä¸ºä¸´æ—¶è¡¨ `temp`
- æŸ¥è¯¢ä¸´æ—¶è¡¨ `temp` ï¼Œ ç­›é€‰æ¡ä»¶æ˜¯ `desc_frequency >= total_frequency / 2 and asc_frequency >= total_frequency / 2` ï¼Œ `desc_frequency` çš„ä¸€åŠå°±æ˜¯ä¸­ä½æ•°
- é€šè¿‡ç­›é€‰æ¡ä»¶æŸ¥è¯¢å‡ºæ¥çš„ `num` å°±æ˜¯ä¸­ä½æ•°ï¼Œä½¿ç”¨ `avg` å¯¹å…¶æ±‚å¹³å‡æ•°ï¼Œå› ä¸ºå¦‚æœæ˜¯å¶æ•°ä¸ªçš„è¯ï¼ŒæŸ¥å‡ºæ¥çš„ä¸­ä½æ•°æ˜¯ä¸¤ä¸ªã€‚

## SQLï¼šæ–¹æ³•äºŒ

```sql
select avg(num) as median from (
	select
		num,
		(
			select sum(frequency) from numbers n2 where n1.num >= n2.num
		) asc_frequency,
		(
			select sum(frequency) from numbers n3 where n1.num <= n3.num
		) desc_frequency,
		(select sum(frequency) from numbers) total_frequency
	from numbers n1
) temp
where asc_frequency >= total_frequency / 2
and desc_frequency >= total_frequency / 2;
```

## è§£æ

å’Œæ–¹æ³•ä¸€çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰ä½¿ç”¨çª—å£å‡½æ•° `over()` ï¼Œè€Œæ˜¯ä½¿ç”¨æŸ¥è¯¢çš„æ–¹å¼å¹¶é€šè¿‡ `sum()` è®¡ç®—å‡º `asc_frequency` ã€ `desc_frequency` ã€ `total_frequency`

## SQLï¼šæ–¹æ³•ä¸‰

```sql
select avg(num) as median from (
	select n1.num from numbers n1 join numbers n2 group by n1.num
	having sum(if(n1.num >= n2.num, n2.frequency, 0)) >= sum(n2.frequency) / 2
	and sum(if(n1.num <= n2.num, n2.frequency, 0)) >= sum(n2.frequency) / 2
) as temp;
```

## è§£æ

- å°† `numbers` è¡¨è‡ªè¿æ¥ï¼Œå¹¶æŒ‰ç…§ `n1.num` åˆ†ç»„
- è®¡ç®—
  - `if(n1.num >= n2.num, n2.frequency, 0)` ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä»€ä¹ˆä½¿ç”¨ `n2.frequency` æ˜¯å› ä¸ºæŒ‰ç…§ `n1.num` è¿›è¡Œåˆ†ç»„çš„ï¼Œå†ä½¿ç”¨ `sum()` è®¡ç®— `n1.num` æ¯” `n2.num` å¤§çš„ `n2.frequency`
    - å½“ `n1.num = 0` åªä¼šå¤§äºç­‰ä¸ `n2.num = 0` ï¼Œåªä¼šè®¡ç®— `0` çš„ `n2.frequency`
    - å½“ `n1.num = 1` ç¬¦åˆæ¡ä»¶çš„æœ‰ `n2.num = 0, n2.num = 1` ï¼Œå°±ä¼šè®¡ç®— `0` å’Œ `1` çš„ `n2.frequency`
  - `if(n1.num >= n2.num, n2.frequency, 0)` ï¼Œä¹Ÿæ˜¯åŒæ ·çš„æµç¨‹

## Tips

è¿™ä¸‰ç§æ–¹æ³•éƒ½æ˜¯åˆ©ç”¨æŸä¸€æ•°çš„æ­£åºæˆ–è€…é€†åºçš„ç´¯è®¡å¤§äºæˆ–ç­‰äºæ‰€æœ‰æ•°çš„ä¸ªæ•°çš„ä¸€åŠ


æ›´å¤šè§£é¢˜ï¼šhttps://github.com/astak16/blog-mysql/issues/35
# 4.å·²çŸ¥é¢‘æ•°æ‰¾ä¸­ä½æ•°å°æŠ€å·§
**åŸç†**

+----------+-------------+-------------+-------------+
|  Number  |  Frequency  |  sum1(asc)  |  sum2(desc) |
+----------+-------------|-------------+-------------|
|  0       |  5          | 5           | 10          |
|  1       |  1          | 6           | 5           |
|  2       |  3          | 9           | 4           |
|  3       |  1          | 10          | 1           |
+----------+-------------|-------------+-------------|
å½“sum1å’Œsum2éƒ½å¤§äºç­‰äºæ€»æ•°çš„1/2æ—¶ï¼ŒNumberçš„å¹³å‡æ•°å°±æ˜¯ä¸­ä½æ•°ã€‚

**ä»£ç **
```
select avg(Number) median from
(
    select Number, Frequency, 
    sum(Frequency) over (order by Number desc) s1,
    sum(Frequency) over (order by Number asc) s2,
    sum(Frequency) over () s3
    from Numbers
) exp
where s1 >= s3/2 and s2 >= s3/2

```



