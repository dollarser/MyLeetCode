# 1532æœ€è¿‘çš„ä¸‰ç¬”è®¢å•
<p>è¡¨ï¼š<code>Customers</code></p>

<pre>
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
+---------------+---------+
customer_id æ˜¯è¯¥è¡¨ä¸»é”®
è¯¥è¡¨åŒ…å«æ¶ˆè´¹è€…çš„ä¿¡æ¯
</pre>

<p>Â </p>

<p>è¡¨ï¼š<code>Orders</code></p>

<pre>
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| order_date    | date    |
| customer_id   | int     |
| cost          | int     |
+---------------+---------+
order_id æ˜¯è¯¥è¡¨ä¸»é”®
è¯¥è¡¨åŒ…å«idä¸ºcustomer_idçš„æ¶ˆè´¹è€…çš„è®¢å•ä¿¡æ¯
æ¯ä¸€ä¸ªæ¶ˆè´¹è€…<strong> æ¯å¤©ä¸€ç¬”è®¢å•</strong>
</pre>

<p>Â </p>

<p>å†™ä¸€ä¸ª SQL è¯­å¥ï¼Œæ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„æœ€è¿‘ä¸‰ç¬”è®¢å•ã€‚å¦‚æœç”¨æˆ·çš„è®¢å•å°‘äº 3 ç¬”ï¼Œåˆ™è¿”å›ä»–çš„å…¨éƒ¨è®¢å•ã€‚</p>

<p>è¿”å›çš„ç»“æœæŒ‰ç…§ <code>customer_name</code>Â <strong>å‡åº</strong>æ’åˆ—ã€‚å¦‚æœæ’åæœ‰ç›¸åŒï¼Œåˆ™ç»§ç»­æŒ‰ç…§ <code>customer_id</code> <strong>å‡åº</strong>æ’åˆ—ã€‚å¦‚æœæ’åè¿˜æœ‰ç›¸åŒï¼Œåˆ™ç»§ç»­æŒ‰ç…§ <code>order_date</code> <strong>é™åº</strong>æ’åˆ—ã€‚</p>

<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<pre>
<code>Customers</code>
+-------------+-----------+
| customer_id | name      |
+-------------+-----------+
| 1           | Winston   |
| 2           | Jonathan  |
| 3           | Annabelle |
| 4           | Marwan    |
| 5           | Khaled    |
+-------------+-----------+

<code>Orders</code>
+----------+------------+-------------+------+
| order_id | order_date | customer_id | cost |
+----------+------------+-------------+------+
| 1        | 2020-07-31 | 1           | 30   |
| 2        | 2020-07-30 | 2           | 40   |
| 3        | 2020-07-31 | 3           | 70   |
| 4        | 2020-07-29 | 4           | 100  |
| 5        | 2020-06-10 | 1           | 1010 |
| 6        | 2020-08-01 | 2           | 102  |
| 7        | 2020-08-01 | 3           | 111  |
| 8        | 2020-08-03 | 1           | 99   |
| 9        | 2020-08-07 | 2           | 32   |
| 10       | 2020-07-15 | 1           | 2    |
+----------+------------+-------------+------+

Result tableï¼š
+---------------+-------------+----------+------------+
| customer_name | customer_id | order_id | order_date |
+---------------+-------------+----------+------------+
| Annabelle     | 3           | 7        | 2020-08-01 |
| Annabelle     | 3           | 3        | 2020-07-31 |
| Jonathan      | 2           | 9        | 2020-08-07 |
| Jonathan      | 2           | 6        | 2020-08-01 |
| Jonathan      | 2           | 2        | 2020-07-30 |
| Marwan        | 4           | 4        | 2020-07-29 |
| Winston       | 1           | 8        | 2020-08-03 |
| Winston       | 1           | 1        | 2020-07-31 |
| Winston       | 1           | 10       | 2020-07-15 |
+---------------+-------------+----------+------------+
Winston æœ‰ 4 ç¬”è®¢å•, æ’é™¤äº† "2020-06-10" çš„è®¢å•, å› ä¸ºå®ƒæ˜¯æœ€è€çš„è®¢å•ã€‚
Annabelle åªæœ‰ 2 ç¬”è®¢å•, å…¨éƒ¨è¿”å›ã€‚
Jonathan æ°å¥½æœ‰ 3 ç¬”è®¢å•ã€‚
Marwan åªæœ‰ 1 ç¬”è®¢å•ã€‚
ç»“æœè¡¨æˆ‘ä»¬æŒ‰ç…§ customer_name å‡åºæ’åˆ—ï¼Œcustomer_id å‡åºæ’åˆ—ï¼Œorder_date é™åºæ’åˆ—ã€‚
</pre>

<p>Â </p>

<p><strong>è¿›é˜¶ï¼š</strong></p>

<ul>
	<li>ä½ èƒ½å†™å‡ºæ¥æœ€è¿‘Â <code>n</code>Â ç¬”è®¢å•çš„é€šç”¨è§£å†³æ–¹æ¡ˆå—?</li>
</ul>
































# è§£é¢˜:
# 1.çª—å£å‡½æ•°
### ä»£ç 

```mysql
select 
    customer_name,
    customer_id,
    order_id,
    order_date
from (
    select 
        name customer_name,
        customer_id,
        order_id,
        order_date,
        row_number() over(partition by customer_id order by order_date desc) num
    from Orders O
    inner join Customers using(customer_id)
)A
where num < 4
order by customer_name, customer_id, order_date desc


```
# 2.ã€track & traningã€‘æ€è·¯ç®€å•ï¼Œæ€§èƒ½é«˜æ•ˆ
### æ–¹ä¾¿å¿«é€Ÿå­¦ä¹ ç®—æ³•ä¸ç†è§£~
ğŸŒ‡ ç‚¹èµ ğŸ‘ æ”¶è— â­ç•™è¨€ ğŸ“ ä¸€é”®ä¸‰è¿ ~å…³æ³¨Jamï¼Œä»ä½ æˆ‘åšèµ·ï¼

**å…„å¼Ÿä¼šèƒŒå›ä½ ï¼Œå¥³äººä¼šç¦»å¼€ä½ ï¼Œé‡‘é’±ä¼šè¯±æƒ‘ä½ ï¼Œç”Ÿæ´»ä¼šåˆéš¾ä½ ï¼Œåªæœ‰æ•°å­¦ä¸ä¼šï¼Œä¸ä¼šå°±æ˜¯ä¸ä¼š**
**å¤©æ‰ä¸å¦ï¼Œå–å†³äºæœ€ç»ˆè¾¾åˆ°çš„é«˜åº¦ã€‚çœŸæ­£çš„å¤©æ‰æ˜¯é‚£äº›è„šè¸å®åœ°çš„äºº**
**é™ä¸‹å¿ƒæ¥å¥½å¥½åšè‡ªå·±ï¼Œèµ°ç¨³è„šä¸‹æ¯ä¸€æ­¥ï¼Œå°±æ˜¯æœ€å¥½çš„è·¯ï¼Œå¼ºè€…éƒ½æ˜¯å­¤ç‹¬çš„**

æ¨è python ç®—æ³•çš„ä¹¦ç±ï¼Œä½“ç³»åŒ–å­¦ä¹ ç®—æ³•ä¸æ•°æ®ç»“æ„ï¼Œç”¨æ­£ç¡®çš„æ–¹å¼æˆä¸ºofferæ”¶å‰²æœº
[leetcode](https://github.com/ls1248659692/leetcode) â€”â€”  **ç³»ç»ŸåŒ–å¿«é€Ÿå­¦ä¹ ç®—æ³•ï¼Œè¿™ä¸æ˜¯å†…å·ï¼Œè¿™åªæ˜¯æ‚„æ‚„åœ°åŠªåŠ›ï¼Œç„¶åæƒŠè‰³æ‰€æœ‰çš„äºº**
![image.png](https://pic.leetcode-cn.com/1649827618-sKaaPy-image.png)

---
### æ±‚è§£æ€è·¯
1. è·å–æ¯ä¸ªç”¨æˆ·çš„è®¢å•ï¼Œ æŒ‰ç…§æ—¶é—´é¡ºåºé€†åº
```
SELECT  
    order_id,
    order_date,
    customer_id,
    row_number() over(partition by customer_id order by order_date DESC) as rank_tag
FROM orders 
```
2. æ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„æœ€è¿‘ä¸‰ç¬”è®¢å•ã€‚å¦‚æœç”¨æˆ·çš„è®¢å•å°‘äº 3 ç¬”ï¼Œåˆ™è¿”å›ä»–çš„å…¨éƒ¨è®¢å•
```
LEFT JOIN customers c  
    ON t.customer_id = c.customer_id 
rank_tag <= 3
```
3. æŒ‰ç…§customer_name å‡åºæ’åˆ— ustomer_id å‡åºæ’åˆ—  order_date é™åº  

```
ORDER BY  name, customer_id, order_date DESC
```

### ä»£ç 

```mysql
# Write your MySQL query statement below
SELECT 
    c.name customer_name,
    c.customer_id, 
    t.order_id, 
    t.order_date
FROM (
    SELECT  
        order_id,
        order_date,
        customer_id,
        row_number() over(partition by customer_id order by order_date DESC) as rank_tag
    FROM orders ) t
LEFT JOIN customers c  
    ON t.customer_id = c.customer_id    
WHERE 
    rank_tag <= 3
ORDER BY 
    name, customer_id, order_date DESC;
```
# 3.rankå‡½æ•°å¸¸è§„è§£æ³•
```
select
        name customer_name,
        customer_id,
        order_id,
        order_date
from
(
        select name,o.customer_id,order_date,order_id,
                rank() over(partition by customer_id order by order_date desc) rk
        from orders o
        join customers c on c.customer_id = o.customer_id
) t
where rk <= 3
order by name,customer_id,order_date desc;
```
# 4.1532. æœ€è¿‘çš„ä¸‰ç¬”è®¢å•
### è§£é¢˜æ€è·¯
æ­¤å¤„æ’°å†™è§£é¢˜æ€è·¯

### ä»£ç 

```mysql
select b.name as customer_name,b.customer_id, a.order_id, a.order_date
from(
    select *,
        row_number() over(partition by customer_id order by order_date desc) as rnk # æœ€è¿‘ï¼
    from orders) a 
left join customers b on a.customer_id = b.customer_id    
where rnk <= 3
order by name, customer_id, order_date desc

```
