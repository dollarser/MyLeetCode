# 512æ¸¸æˆç©æ³•åˆ†æ II
<p>Table:&nbsp;<code>Activity</code></p>

<pre>
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| player_id    | int     |
| device_id    | int     |
| event_date   | date    |
| games_played | int     |
+--------------+---------+
(player_id, event_date) æ˜¯è¿™ä¸ªè¡¨çš„ä¸¤ä¸ªä¸»é”®
è¿™ä¸ªè¡¨æ˜¾ç¤ºçš„æ˜¯æŸäº›æ¸¸æˆç©å®¶çš„æ¸¸æˆæ´»åŠ¨æƒ…å†µ
æ¯ä¸€è¡Œæ˜¯åœ¨æŸå¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡ç™»å‡ºä¹‹å‰ç™»å½•å¹¶ç©å¤šä¸ªæ¸¸æˆï¼ˆå¯èƒ½ä¸º0ï¼‰çš„ç©å®¶çš„è®°å½•
</pre>

<p>è¯·ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæè¿°æ¯ä¸€ä¸ªç©å®¶é¦–æ¬¡ç™»é™†çš„è®¾å¤‡åç§°</p>

<p>æŸ¥è¯¢ç»“æœæ ¼å¼åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š</p>

<pre>
Activity table:
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
| 1         | 2         | 2016-03-01 | 5            |
| 1         | 2         | 2016-05-02 | 6            |
| 2         | 3         | 2017-06-25 | 1            |
| 3         | 1         | 2016-03-02 | 0            |
| 3         | 4         | 2018-07-03 | 5            |
+-----------+-----------+------------+--------------+

Result table:
+-----------+-----------+
| player_id | device_id |
+-----------+-----------+
| 1         | 2         |
| 2         | 3         |
| 3         | 1         |
+-----------+-----------+</pre>
































# è§£é¢˜:
# 1.ã€LC SQL70ã€‘512. æ¸¸æˆç©æ³•åˆ†æ II(GROUP BYçš„ç»†èŠ‚)
# GROUP BY
- GROUP BYæŒ‰column_nameæˆ–column_name1,...,column_nameNæ‰€ç»„æˆçš„å”¯ä¸€å€¼å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå‹ç¼©æˆä¸€è¡Œæ•°æ®
- GROUP BYæ­é…SELECT Aggregate_fuction(column_name)ï¼Œæ ¹æ®Aggregate_fuction()è¾“å‡ºä¸€æ¡è®°å½•
- GROUP BYä¸æ­é…SELECT Aggregate_fuction(column_name)ï¼Œé»˜è®¤å–åˆ†ç»„ç»“æœçš„ç¬¬ä¸€æ¡è®°å½•
- **GROUP BYç­›é€‰çš„ä¸æ˜¯å®Œæ•´çš„ä¸€è¡Œè®°å½•ï¼ŒWHEREç­›é€‰çš„æ˜¯å®Œæ•´çš„ä¸€è¡Œè®°å½•**
# è¿‡ç¨‹å‰–æ
ç»™å‡ºActivity Table

![image.png](https://pic.leetcode.cn/1679561800-zMZqTb-image.png){:width=400}

æ ¹æ®é¢˜ç›®è¦æ±‚ï¼Œå¾ˆå®¹æ˜“é”™è¯¯åœ°æ‰“å‡ºä»¥ä¸‹ä»£ç 
```
WITH cte AS(
    SELECT 
        player_id,device_id,MIN(event_date)
    FROM Activity
    GROUP BY player_id
)

SELECT player_id,device_id
FROM cte
```
**å› å¯¹GROUP BYç†è§£ä¸é€å½»æ‰€å¹»æƒ³çš„æŸ¥è¯¢ç»“æœ**

![image.png](https://pic.leetcode.cn/1679565178-nhpJiQ-image.png){:width=400}

**å®é™…ç»“æœ**

```
2. SELECT device_id,MIN(event_date)
```
![image.png](https://pic.leetcode.cn/1679563416-UHHUrv-image.png){:width=400}

**è§£æ³•ä¸€ï¼šçª—å£æ’åå‡½æ•°**
```
WITH cte AS(
    SELECT 
    	player_id, 
    	device_id, 
    	DENSE_RANK() OVER(PARTITION BY player_id ORDER BY event_date ASC) AS ranking
   	FROM Activity
)

SELECT
	player_id, device_id
FROM cte
WHERE ranking=1
```
**è§£æ³•äºŒï¼šWHERE INå­åŒ¹é…ï¼ˆè”åˆé”®ï¼‰**
```
SELECT 
	player_id,
    device_id
FROM Activity
WHERE(player_id,event_date)IN (
    SELECT 
        player_id,
        MIN(event_date)
	FROM Activity
	GROUP BY player_id
)
```
# 2.è”åˆå­æŸ¥è¯¢/ DENSE_RANK/
æ–¹æ³•1ï¼šæ˜¯æˆ‘ç¬¬ä¸€æ¬¡çŸ¥é“å­æŸ¥è¯¢å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼ˆå¯èƒ½ä¹‹å‰çœ‹åˆ°è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰æƒ³èµ·æ¥ï¼Œè¯´æ˜ä¹Ÿæ˜¯æ²¡æŒæ¡ï¼‰

ä¸€å¼€å§‹å†™çš„æ—¶å€™ åªä½¿ç”¨ event_date æ¥åŒ¹é…å­æŸ¥è¯¢ä¸­çš„æ—¥æœŸï¼Œæ‰€ä»¥åœ¨æµ‹è¯•çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸åŒçš„äººå¯èƒ½åœ¨åŒä¸€å¤©éƒ½æœ‰æ¸¸ç©è®°å½•ã€‚

ä½¿ç”¨è”åˆå­æŸ¥è¯¢ï¼Œé€šè¿‡æŸ¥è¯¢ (player_id, event_date) æ¥åŒ¹é…å­æŸ¥è¯¢ä¸­çš„æ¡ä»¶å¯ä»¥å¾ˆå¥½çš„é¿å…å¤šä¸ªç”¨æˆ·åœ¨åŒä¸€å¤©ç™»å½•ï¼Œä½¿ç”¨ event_date æ¥åŒ¹é…å‡ºç°çš„é—®é¢˜ã€‚

```
SELECT
    player_id,
    device_id
FROM Activity
WHERE (player_id,event_date) in (
    SELECT
        player_id,
        MIN(event_date) min_date
    FROM Activity
    GROUP BY player_id
)
```


æ–¹æ³•2ï¼šä½¿ç”¨çª—å£å‡½æ•°ï¼Œåˆ©ç”¨ç”¨æˆ·idåˆ†ç»„åï¼Œå¯¹æ—¥æœŸè¿›è¡Œæ’åï¼Œç„¶åæŸ¥æ‰¾å‡ºæ‰€æœ‰rank=1çš„device_idï¼Œçª—å£å‡½æ•°ä¹Ÿèƒ½å¾ˆå¥½çš„é¿å…å¤šä¸ªç”¨æˆ·åœ¨åŒä¸€å¤©æ¸¸ç©å‡ºç°çš„é—®é¢˜ï¼Œå› ä¸ºæ’åæ˜¯ç»„å†…æ’åã€‚
```
SELECT
    tmp.player_id player_id,
    tmp.device_id device_id
FROM(
    SELECT
        player_id,
        device_id,
        dense_rank() over(partition by player_id order by event_date) as `rank`
    FROM Activity
)AS tmp
WHERE tmp.rank = 1
```
# 3.ã€é²¸æã€‘512. æ¸¸æˆç©æ³•åˆ†æ IIï¼ˆè€ƒç‚¹ï¼šçª—å£æ’åº vs. å­æŸ¥è¯¢ç­›é€‰ï¼‰
##### æ€è·¯

ä¸Šä¸€é¢˜ï¼Œæˆ‘ä»¬è®¡ç®—å‡ºäº†æ¯ä¸ªç©å®¶æ˜¯é¦–æ¬¡ç™»é™†æ—¥æœŸï¼Œè¿™å›æˆ‘ä»¬è¦æ ¹æ®é¦–æ¬¡ç™»é™†æ—¥æœŸï¼Œå†å»å¯»æ‰¾å¯¹åº”çš„è®¾å¤‡åç§°ï¼Œé‚£ä¹ˆè·Ÿç€ä¸Šé¢˜æ€è·¯ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨**å­æŸ¥è¯¢ where in çš„è”åˆåŒ¹é…**ã€‚

å¦‚æœæŠ›å¼€ä¸Šä¸€é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**çª—å£å‡½æ•°æ’åº**ï¼Œç„¶ååˆ©ç”¨æ’åºä½œä¸ºç­›é€‰æ¡ä»¶ã€‚

##### ç®—æ³•

1. ä¸ç”¨çª—å£ï¼šåŒ¹é…`(player_id, event_date)`æ˜¯å¦åœ¨æ¯ä¸€ä¸ªç©å®¶çš„é¦–æ¬¡ç™»é™†æ—¥æœŸä¸­
2. ç”¨çª—å£ï¼šå…ˆæŒ‰æ—¶é—´æ’å€’åºï¼Œå†åˆ©ç”¨æ’åº`rnk=1`ç­›é€‰

##### ç­”æ¡ˆ

1. ä¸ç”¨çª—å£å‡½æ•°ï¼Œä½¿ç”¨è”åˆé”®å­æŸ¥è¯¢ where in ç­›é€‰

```sql
select 
	player_id, device_id
from activity
where (player_id, event_date) in 
(
    select player_id, min(event_date)
	from activity
	group by player_id
)
```

```sql
# è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼
# å¿…é¡»ç”¨è”åˆé”®æ¥åŒ¹é…
select 
	player_id, device_id
from activity
where event_date in 
(
    select min(event_date)
	from activity
	group by player_id
)
```

âœï¸å°æŠ€å·§ï¼š

![image.png](https://pic.leetcode-cn.com/1651745557-JqFxKG-image.png)


2. çª—å£

```sql
select 
	player_id, device_id
from 
(
    select 
    	player_id, 
    	device_id, 
    	dense_rank() over(partition by player_id 
                          order by event_date asc) rnk 
   	from activity
) a where rnk=1
```

ğŸ¥°è§‰å¾—è¿˜ä¸é”™çš„è¯ï¼Œç‚¹ä¸ªèµï¼ŒåŠ ä¸ªå…³æ³¨å§~ğŸ¥°




# 4.WindowFunction ç”¨æ—¶å‡»è´¥100%ç”¨æˆ·çš„è§£æ³•
![image.png](https://pic.leetcode.cn/1674851519-qjxFPh-image.png){:width=400}
æ­¤é¢˜å’Œå–salaryé‚£é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯group byä¹‹åæ¥é€‰top1ï¼Œé‡åˆ°è¿™ç±»é¢˜æ— è®ºtopå‡ ï¼Œéƒ½å¯ä»¥ä½¿ç”¨window funtionæ¥ç»™å‡ºä¸€ä¸ªæ–°çš„æ’åºï¼Œé€šè¿‡å¤–å±‚whereé‡Œé™å®šæ¡ä»¶æ¥è¿›è¡Œç­›é€‰ã€‚è¦æ³¨æ„ä¸‰ç§rankçš„åŒºåˆ«ã€‚
```
SELECT
player_id,device_id
FROM
(  SELECT player_id, device_id,
row_number() OVER(partition by player_id order by event_date) as rn
    FROM
    Activity)s

Where rn=1
```

