# 1097æ¸¸æˆç©æ³•åˆ†æ V
<p><code>Activity</code> æ´»åŠ¨è®°å½•è¡¨</p>

<pre>
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| player_id    | int     |
| device_id    | int     |
| event_date   | date    |
| games_played | int     |
+--------------+---------+
ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®
è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µ
æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œåœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ï¼Œç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0ï¼‰
</pre>

<p>Â </p>

<p>ç©å®¶çš„ <strong>å®‰è£…æ—¥æœŸ</strong> å®šä¹‰ä¸ºè¯¥ç©å®¶çš„ç¬¬ä¸€ä¸ªç™»å½•æ—¥ã€‚</p>

<p>ç©å®¶çš„ <strong>ç¬¬ä¸€å¤©ç•™å­˜ç‡</strong> å®šä¹‰ä¸ºï¼šå‡å®šå®‰è£…æ—¥æœŸä¸º <code>X</code>Â çš„ç©å®¶çš„æ•°é‡ä¸º <code>N</code> ï¼Œå…¶ä¸­åœ¨ <code>X</code>Â ä¹‹åçš„ä¸€å¤©é‡æ–°ç™»å½•çš„ç©å®¶æ•°é‡ä¸º <code>M</code> ï¼Œ<code>M/N</code> å°±æ˜¯ç¬¬ä¸€å¤©ç•™å­˜ç‡ï¼Œ<strong>å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½</strong>ã€‚</p>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŠ¥å‘Šæ‰€æœ‰å®‰è£…æ—¥æœŸã€å½“å¤©å®‰è£…æ¸¸æˆçš„ç©å®¶æ•°é‡å’Œç©å®¶çš„ç¬¬ä¸€å¤©ç•™å­˜ç‡ã€‚</p>

<p>Â </p>

<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre>
Activity è¡¨ï¼š
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
| 1         | 2         | 2016-03-01 | 5            |
| 1         | 2         | 2016-03-02 | 6            |
| 2         | 3         | 2017-06-25 | 1            |
| 3         | 1         | 2016-03-01 | 0            |
| 3         | 4         | 2016-07-03 | 5            |
+-----------+-----------+------------+--------------+

Result è¡¨ï¼š
+------------+----------+----------------+
| install_dt | installs | Day1_retention |
+------------+----------+----------------+
| 2016-03-01 | 2        | 0.50           |
| 2017-06-25 | 1        | 0.00           |
+------------+----------+----------------+
ç©å®¶ 1 å’Œ 3 åœ¨ 2016-03-01 å®‰è£…äº†æ¸¸æˆï¼Œä½†åªæœ‰ç©å®¶ 1 åœ¨ 2016-03-02 é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥ 2016-03-01 çš„ç¬¬ä¸€å¤©ç•™å­˜ç‡æ˜¯ 1/2=0.50
ç©å®¶ 2 åœ¨ 2017-06-25 å®‰è£…äº†æ¸¸æˆï¼Œä½†åœ¨ 2017-06-26 æ²¡æœ‰é‡æ–°ç™»å½•ï¼Œå› æ­¤ 2017-06-25 çš„ç¬¬ä¸€å¤©ç•™å­˜ç‡ä¸º 0/1=0.00
</pre>
































# è§£é¢˜:
# 1.å››ç§æ–¹æ³•è¯¦ç»†è®²è§£â€”â€”æ¸¸æˆç©æ³•åˆ†æ V
## åˆ†æ

éœ€è¦å‡ ä¸ªå€¼

1. æ¯ä¸ªç©å®¶ç¬¬ä¸€ä¸ªç™»å½•æ—¥
2. ç¬¬ä¸€ä¸ªç™»é™†æ—¥ä¹‹åæœ‰æ²¡æœ‰ç™»å½•
3. ç¬¬ä¸€ä¸ªç™»å½•æ—¥çš„ç©å®¶çš„æ•°é‡ï¼Œç¬¬ä¸€ä¸ªç™»å½•æ—¥çš„ç¬¬äºŒå¤©ç™»å½•ç©å®¶çš„æ•°é‡

## SQLï¼šæ–¹æ³•ä¸€

```sql
select
	first_date as install_dt,
	count(*) installs,
	round(count(activity.event_date) / count(*), 2) as day1_retention
from (
	select 
		player_id,
		min(event_date) as first_date
	from activity group by player_id
) t1 left join activity
on t1.player_id = activity.player_id 
and datediff(activity.event_date, t1.first_date) = 1
group by first_date;
```

## è§£æ

1. æ¯ä¸ªç©å®¶ç¬¬ä¸€ä¸ªç™»å½•æ—¥ï¼Œä½œä¸º `t1` è¡¨
    
    ```sql
    select 
    	player_id,
    	min(event_date) as first_date
    from activity group by player_id;
    ```
    
2. éœ€è¦å¾—åˆ°æ¯ä¸ªç©å®¶ç¬¬ä¸€ä¸ªç™»é™†æ—¥ä¹‹åç¬¬äºŒå¤©æœ‰æ²¡æœ‰ç™»å½•
    1. å°† `t1` è¡¨å’Œ `activity` å·¦è¿
    2. è¿™è¦æ³¨æ„è¾“å‡ºçš„å­—æ®µ `event_date` æ˜¯ç¬¬ä¸€å¤©ç™»å½•ä¹‹åç¬¬äºŒå¤©åˆç™»å½•çš„ç©å®¶æ—¥æœŸ
    
    ```sql
    select * from t1 
    left join activity 
    on t1.player_id = activity.player_id 
    and datediff(activity.event_date, t1.first_date) = 1;
    ```
    
3. æŸ¥è¯¢ `t1` å’Œ `activity` å·¦è¿åçš„è¡¨ï¼ŒæŒ‰ç…§ç¬¬ä¸€ä¸ªç™»é™†æ—¥è¿›è¡Œåˆ†ç»„ `first_date`
    1. `count(*)` ç¬¬ä¸€ä¸ªç™»é™†æ—¥çš„æ€»äººæ•°
    2. `count(activity.event_date)` ç¬¬äºŒä¸ªç™»å½•æ—¥çš„äººæ•°
    3.  `a/b` æ˜¯ç¬¬ä¸€å¤©ç©å®¶çš„ç•™å­˜ç‡

## SQLï¼šæ–¹æ³•äºŒ

```sql
select
	first_date as install_dt,
	count(distinct player_id) as installs,
	round(
		sum(if(date_add(first_date, interval 1 day) = event_date, 1, 0)) 
		/ count(distinct player_id),
	2) as day1_retention
from (
	select 
		player_id,
		event_date,
		min(event_date) over(partition by player_id) as first_date
	from activity
) t1 group by first_date;
```

## è§£æ

æ–¹æ³•äºŒçš„æ€è·¯å’Œæ–¹æ³•ä¸€æ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨äº†çª—å£å‡½æ•°ä»£æ›¿äº†åˆ†ç»„ã€‚

1. ä½¿ç”¨çª—å£å‡½æ•°ï¼Œè®¡ç®—å‡ºæ¯ä¸ªç©å®¶çš„ç¬¬ä¸€æ¬¡ç™»å½•æ—¥æœŸï¼Œä½œä¸ºä¸´æ—¶è¡¨ `t1`
    
    ```sql
    select 
    	player_id,
    	event_date,
    	min(event_date) over(partition by player_id) as first_date
    from activity;
    ```
    
    è¾“å‡º
    
    ```sql
    player_id	 |  event_date  |  first_date
    1	         |  2016-03-01  |  2016-03-01
    1          |	2016-03-02	|  2016-03-01
    2          |	2017-06-25	|  2017-06-25
    3	         |  2016-03-01	|  2016-03-01
    3	         |  2018-07-03	|  2016-03-01
    ```
    
2. æŸ¥è¯¢ `t1` ï¼ŒæŒ‰ç…§ `first_date` è¿›è¡Œåˆ†ç»„
    1. `count(distinct player_id)` ç¬¬ä¸€ä¸ªç™»é™†æ—¥çš„æ€»äººæ•°
    2. `sum(if(date_add(first_date, interval 1 day) = event_date, 1, 0))` 
        1. `date_add(first_date, interval 1 day) = event_date` ç¬¬ä¸€ä¸ªç™»é™†æ—¥åä¸€å¤©ä¹Ÿç™»å½•çš„ç”¨æˆ·
        2. `sum(if(expr, 1, 0))` æˆ–è€… `count(if(expr, 1, null))` ï¼Œä½¿ç”¨ `sum` æ±‚å’Œ `if` è¡¨è¾¾å¼çš„ `false` åº”è¯¥ç”¨ `0` ï¼Œä½¿ç”¨ `count` æ±‚å’Œ `if` è¡¨è¾¾å¼çš„ `false` åº”è¯¥ç”¨ `null` ï¼Œå› ä¸º `count` ä¼šå¿½ç•¥ `null`

## SQLï¼šæ–¹æ³•ä¸‰

```sql
select
	a1.event_date as install_dt,
	count(a1.event_date) as installs,
	round(
		sum(if(datediff(a2.event_date, a1.event_date) = 1, 1, 0))
		 / count(a1.event_date),
	2) as day1_retention
from activity a1
left join activity a2 on a1.player_id = a2.player_id 
and datediff(a2.event_date, a1.event_date) = 1
left join activity a3 on a1.player_id = a3.player_id
and a1.event_date > a3.event_date
where a3.event_date is null
group by a1.event_date;
```

## è§£æ

`activity` è¡¨è‡ªèº«å·¦è¿ `2` æ¬¡

1. ç­›é€‰å‡ºç¬¬ä¸€å¤©ç™»å½•çš„ç©å®¶ï¼Œç¬¬äºŒå¤©ä¹Ÿç™»å½•äº† `datediff(a2.event_date, a1.event_date) = 1`
    
    ```sql
    select 
    	* 
    from activity a1
    left join activity a2 on a1.player_id = a2.player_id
    and datediff(a2.event_date, a1.event_date) = 1
    ```
    
2. ç­›é€‰å‡ºç¬¬ä¸€ä¸ªç™»å½•æ—¥ï¼Œå› ä¸º `a1.event_date > a3.event_date` ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªç™»å½•æ—¥ `a3.event_date` ä¸º `null`
    
    ```sql
    select 
    	* 
    from activity a1
    left join activity a3 on a1.player_id = a3.player_id
    and a1.event_date > a3.event_date where a3.event_date is null
    ```
    
3. åˆå¹¶ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥
    
    ```sql
    select 
    	* 
    from activity a1
    left join activity a2 on a1.player_id = a2.player_id
    and datediff(a2.event_date, a1.event_date) = 1
    left join activity a3 on a1.player_id = a3.player_id
    and a1.event_date > a3.event_date where a3.event_date is null
    ```
    
4. è®¡ç®—å‡ºå¯¹åº”çš„å€¼
    1. `a1.event_date` æ˜¯ç¬¬ä¸€ä¸ªç™»å½•æ—¥
    2. `count(a1.event_date)` ç¬¬ä¸€ä¸ªç™»å½•æ—¥çš„æ€»äººæ•°
    3. `sum(if(datediff(a2.event_date, a1.event_date) = 1, 1, 0))` ç¬¬ä¸€ä¸ªç™»å½•æ—¥çš„ç¬¬äºŒå¤©ç™»å½•çš„æ€»äººæ•°
    4. `b/c` æ˜¯ç¬¬ä¸€å¤©ç©å®¶çš„ç•™å­˜ç‡

## SQLï¼šæ–¹æ³•å››

```sql
select
	first_date as install_dt,
	count(a1.event_date) as installs,
	round(
		sum(if(datediff(a2.event_date, a1.event_date) = 1, 1, 0)) 
		/ count(a1.event_date), 
	2) as day1_retention 
from (
	select 
		player_id,
		min(event_date) first_date
	from activity group by player_id 
) t1
left join activity a1 on t1.player_id = a1.player_id 
and t1.first_date = a1.event_date
left join activity a2 on a1.player_id = a2.player_id
and datediff(a2.event_date, a1.event_date) = 1
group by first_date;
```

## è§£æ

æ–¹æ³•å››å’Œæ–¹æ³•ä¸‰æ˜¯ä¸€ä¸ªæ€è·¯ï¼Œä¸åŒéƒ½æ˜¯æŸ¥è¯¢ç¬¬ä¸€ä¸ªç™»å½•æ—¥ï¼Œç”¨ä¸‹é¢çš„æ–¹æ³•ä»£æ›¿æ–¹æ³•ä¸‰ä¸­çš„ç¬¬äºŒæ­¥ï¼Œæ–¹æ³•ä¸‰ä¸­çš„ç¬¬äºŒæ­¥è¿·æƒ‘æ€§å¾ˆå¤§ï¼Œä¸å¤ªå¥½ç†è§£ã€‚

```sql
select 
	player_id,
	min(event_date) first_date
from activity group by player_id 
```
# 2.çª—å£å‡½æ•°
### è§£é¢˜æ€è·¯
çª—å£å‡½æ•°å±¡è¯•ä¸çˆ½~åœ¨è¯„è®ºåŒºé‡Œé¢å†å­¦ä¹ å­¦ä¹ è‡ªè¿æ¥æ–¹æ³•

### ä»£ç 

```mysql
# Write your MySQL query statement below
SELECT
    first_day as install_dt,
    count(DISTINCT player_id) as installs,
    ROUND(
        (SUM(if(datediff(event_date, first_day) = 1, 1, 0))) / (count(DISTINCT player_id)), 2
    ) as Day1_retention
FROM(
    SELECT
        player_id,
        event_date,
        MIN(event_date) over(partition by player_id) as first_day
    FROM
        Activity
) a 
GROUP BY 
    first_day


```
# 3.ã€track & traningã€‘æ€è·¯ç®€å•ï¼Œæ€§èƒ½é«˜æ•ˆæ¥è¿‘90
### æ–¹ä¾¿å¿«é€Ÿå­¦ä¹ ç®—æ³•ä¸ç†è§£~
ğŸŒ‡ ç‚¹èµ ğŸ‘ æ”¶è— â­ç•™è¨€ ğŸ“ ä¸€é”®ä¸‰è¿ ~å…³æ³¨Jamï¼Œä»ä½ æˆ‘åšèµ·ï¼

**å…„å¼Ÿä¼šèƒŒå›ä½ ï¼Œå¥³äººä¼šç¦»å¼€ä½ ï¼Œé‡‘é’±ä¼šè¯±æƒ‘ä½ ï¼Œç”Ÿæ´»ä¼šåˆéš¾ä½ ï¼Œåªæœ‰æ•°å­¦ä¸ä¼šï¼Œä¸ä¼šå°±æ˜¯ä¸ä¼š**
**å¤©æ‰ä¸å¦ï¼Œå–å†³äºæœ€ç»ˆè¾¾åˆ°çš„é«˜åº¦ã€‚çœŸæ­£çš„å¤©æ‰æ˜¯é‚£äº›è„šè¸å®åœ°çš„äºº**
**é™ä¸‹å¿ƒæ¥å¥½å¥½åšè‡ªå·±ï¼Œèµ°ç¨³è„šä¸‹æ¯ä¸€æ­¥ï¼Œå°±æ˜¯æœ€å¥½çš„è·¯ï¼Œå¼ºè€…éƒ½æ˜¯å­¤ç‹¬çš„**

æ¨è python ç®—æ³•çš„ä¹¦ç±ï¼Œä½“ç³»åŒ–å­¦ä¹ ç®—æ³•ä¸æ•°æ®ç»“æ„ï¼Œç”¨æ­£ç¡®çš„æ–¹å¼æˆä¸ºofferæ”¶å‰²æœº
[leetcode](https://github.com/ls1248659692/leetcode) â€”â€”  **ç³»ç»ŸåŒ–å¿«é€Ÿå­¦ä¹ ç®—æ³•ï¼Œè¿™ä¸æ˜¯å†…å·ï¼Œè¿™åªæ˜¯æ‚„æ‚„åœ°åŠªåŠ›ï¼Œç„¶åæƒŠè‰³æ‰€æœ‰çš„äºº**
![image.png](https://pic.leetcode-cn.com/1649689995-aIUAUZ-image.png)

---
### æ±‚è§£æ€è·¯
1. å…ˆæ±‚è§£æ¯ä¸ªç©å®¶çš„ç™»å½•çš„ç¬¬ä¸€å¤©
2. LEFT JOIN é€šè¿‡ player_id æ‰¾åˆ°é¢„ç™»é™†ç¬¬ä¸€å¤©ç›¸å·®1å¤©çš„ç©å®¶
3. GROUP BY å¯¹ç™»å½•ç¬¬ä¸€å¤©èšåˆï¼Œæ±‚è§£ç•™å­˜ç‡ round(count(distinct b.player_id) / count(distinct a.player_id), 2) Day1_retention

### ä»£ç 

```mysql
SELECT 
    first_date install_dt, 
    count(distinct a.player_id) installs,
    round(count(distinct b.player_id) / count(distinct a.player_id), 2) Day1_retention
FROM (
    SELECT 
        player_id, 
        min(event_date) first_date 
    FROM activity 
    GROUP BY player_id
) a
LEFT JOIN activity b ON a.player_id = b.player_id and DATEDIFF(b.event_date, a.first_date) = 1
GROUP BY first_date
ORDER BY first_date;
```
# 4.left join é¦–å¤©æ‹¼æ¥ç¬¬äºŒå¤©
1.é¦–å…ˆæ±‚å‡ºæ‰€æœ‰ç”¨æˆ·çš„é¦–å¤©æ—¶é—´
2.æ‰€æœ‰ç”¨æˆ·é¦–å¤©åçš„ç™»å½•æ•°æ®
3.left join é™å®šæ—¶é—´å·®ä¸€å¤©å’Œplayer_idç›¸ç­‰ æ­¤æ—¶ç¬¬äºŒå¤©æ²¡ç™»é™†çš„ç”¨æˆ·è®°ä¸ºNULL
4.count() å‡½æ•°è‡ªåŠ¨å‰”é™¤ ç¬¬äºŒå¤©æ²¡æ•°æ®çš„ç”¨æˆ·



```
select first_date as 'install_dt', count(distinct a.player_id) as 'installs',
Round(count(distinct b.player_id)/count(distinct a.player_id), 2) as `Day1_retention`
from (
select player_id, min(event_date) as first_date from Activity group by player_id) a
left join Activity b 
on a.player_id = b.player_id and DATEDIFF(b.event_date, a.first_date)=1
group by first_date 

```



